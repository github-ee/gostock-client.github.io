<html><head><link rel="import" href="../../bower_components/polymer/polymer-element.html"><link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html"><link rel="import" href="../../bower_components/neon-animation/web-animations.html"><link rel="import" href="../../bower_components/iron-dropdown/iron-dropdown.html"><link rel="import" href="../../bower_components/paper-item/paper-item.html"><link rel="import" href="../../bower_components/paper-input/paper-input.html"><link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html"><link rel="import" href="../../bower_components/brum-global-variable/brum-global-variable.html"><link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html"><script src="../../bower_components/webcomponentsjs/webcomponents-loader.js"></script><link rel="import" href="../shared-styles.html"></head><body><dom-module id="gostock-company-buy"><template><style include="shared-styles">:host{display:block;padding:10px;}.content{display:grid;grid-template-columns:80% 20%;grid-template-rows:50px 30px 1fr 30px 1fr;width:100%;}h1{margin-left:20px;}h3{margin-left:20px;}.card{background-color:#E7E7E7;border:1px solid #34BB77;}#top{display:grid;grid-template-columns:0.1fr 0.1fr 0.8fr;margin-left:20px;}#info h3{margin-top:-15px;margin-left:0;}#info p{color:#9B9B9B;}#main p{color:#9B9B9B;}#main h3{margin-top:0px;}#noOfShares{margin-top:-40px;--paper-input-container-input:{font-size:24px;font-weight:600;};}.btn{background-color:transparent;border:none;font-size:16px;outline:none;cursor:pointer;}#buyBtn{color:#34BB77;font-weight:600;}#clearBtn{text-align:right;color:gray;margin-right:20px;}#dropDown{width:100%;height:50px;}paper-menu-button{--paper-menu-button-dropdown:{max-width:100%;right:70vw;};}paper-item{--paper-item:{min-width:100%;cursor:pointer;};}.custom{width:100%;}paper-dropdown-menu, paper-menu, .force-adj-paper-menu{z-index:9998!important;}iron-dropdown.paper-menu-button{z-index:9999!important;right:inherit!important;left:inherit!important;top:inherit!important;left:0 !important;width:100% !important;}#submitBtn{background-color:#34BB77;border:none;color:white;padding:12px;text-align:center;text-decoration:none;display:inline-block;font-family:'Open Sans', sans, sans-serif;font-size:16px;border-radius:12px;text-transform:uppercase;margin-top:40px;width:82%;margin-left:10px;outline:none;cursor:pointer;}#previewContent{display:grid;grid-template-columns:45% 45%;grid-column-gap:5%;grid-template-rows:40px 30px 40px 30px 40px 30px;}#previewContent h3{margin-left:0;margin-top:0px;}#previewContent p{color:#9B9B9B;}.viewmore{background-color:#2C373D;border:none;color:white;padding:12px;text-align:center;text-decoration:none;display:inline-block;font-family:'Open Sans', sans, sans-serif;font-size:16px;border-radius:12px;width:160px;text-transform:uppercase;margin-top:40px;cursor:pointer;}#title{border-radius:12px;border:1px solid #34BB77;background-color:white;height:30px;margin-bottom:40px;}paper-dialog.colored{border:1px solid;border-color:#34BB77;width:600px;height:380px;border-radius:12px;}paper-dialog.colored h3{margin-left:0px;}#subBtn{background-color:#34BB77;border:none;color:white;padding:12px;text-align:center;text-decoration:none;display:inline-block;font-family:'Open Sans', sans, sans-serif;font-size:16px;border-radius:12px;text-transform:uppercase;outline:none;cursor:pointer;font-weight:600;}#canBtn{text-align:center;cursor:pointer;}.buttons{display:grid;grid-template-columns:160px;grid-auto-rows:40px;grid-row-gap:10px;margin-left:-20px;margin-top:10px;}#confContent{display:grid;grid-template-columns:400px 180px;grid-column-gap:10px;grid-template-rows:120px 300px;}</style><brum-global-variable key="transactionData" value="{{lastTransaction}}"></brum-global-variable><brum-global-variable key="userData" value="{{storedUser}}"></brum-global-variable><iron-localstorage name="user-storage" value="[[storedUser]]"></iron-localstorage><button class="viewmore" on-click="goBack">Back</button><iron-ajax id="detailsRequest" url="[[apiUrl]]/api/PullDetailedData" handle-as="json" last-response="{{details}}"></iron-ajax><iron-ajax id="initiateTransactionRequest" method="POST" body="[[initiateTransactionPostBody]]" handle-as="json" content-type="application/json" on-response="_initiateTransactionSuccess" last-response="{{initiateTransactionSuccessObject}}" on-error="_initiateTransactionError" last-error="{{initiateTransactionErrorObject}}" verbose="true" url="[[apiUrl]]/transaction/initiatetransactionpost"></iron-ajax><iron-ajax id="confirmTransactionRequest" method="POST" body="[[confirmTransactionPostBody]]" handle-as="json" content-type="application/json" on-response="_confirmTransactionSuccess" last-response="{{confirmTransactionSuccessObject}}" on-error="_confirmTransactionError" last-error="{{confirmTransactionErrorObject}}" verbose="true" url="[[apiUrl]]/transaction/confirmtransactionpost"></iron-ajax><div class="content"><h1>PLACE AN ORDER</h1><div></div><div id="top"><p>ORDER TO</p><button class="btn" id="buyBtn">BUY</button> <button class="btn" id="clearBtn" on-click="clearVal">CLEAR</button></div><div></div><div class="card" id="main"><p>COMPANY</p><div id="title"><h3>[[details.code]] - [[details.name]]</h3></div><p>NO. OF SHARES TO ORDER</p><paper-input id="noOfShares" value="{{noOfSharesVal}}" prevent-invalid-input="" allowed-pattern="[\d]" error-message="Numbers Only!"></paper-input></div><div class="card" id="info"><p>CODE</p><h3>[[details.code]]</h3><p>AVAILABLE UNITS</p><h3>[[details.volume]]</h3><p>LAST PRICE</p><h3>[[details.close]]</h3><p>CHANGE $</p><h3>$[[details.change_amount]]</h3><p>CHANGE %</p><h3>[[details.change_percentage]]%</h3></div><div id="previewTitle"><h3>ORDER PREVIEW</h3></div><div></div><div class="card" id="preview"><div id="previewContent"><p>AVAILABLE FUNDS</p><p>ORDER TYPE</p><h3>$[[storedUser.currentCash]]</h3><h3>MARKET VALUE</h3><p>ORDER TO</p><p>TRADE VALUE</p><h3>BUY</h3><h3>$[[calcValue]]</h3><p>UNITS</p><p>BROKERAGE</p><h3>[[noOfSharesVal]]</h3><h3>${{brokerage}}</h3></div></div><div><button id="submitBtn" on-click="openDialog">SUBMIT ORDER</button></div></div><paper-dialog id="confirmDialog" class="colored"><div id="confContent"><div><h2>[[details.code]]</h2><h3>[[details.name]]</h3></div><div class="buttons"><paper-button dialog-confirm="" autofocus="" id="subBtn" on-click="_submitOrder">SUBMIT ORDER</paper-button><paper-button dialog-dismiss="" id="canBtn">CANCEL</paper-button></div><div id="previewContent"><p>AVAILABLE FUNDS</p><p>ORDER TYPE</p><h3>$[[storedUser.currentCash]]</h3><h3>MARKET VALUE</h3><p>ORDER TO</p><p>TRADE VALUE</p><h3>BUY</h3><h3>$[[calcValue]]</h3><p>UNITS</p><p>BROKERAGE</p><h3>[[noOfSharesVal]]</h3><h3>${{brokerage}}</h3></div></div></paper-dialog></template><script>class GoStockCompanyBuy extends Polymer.Element{static get is(){return"gostock-company-buy"}static get properties(){return{route:Object,routeData:Object,storedUser:Object,lastTransaction:String,apiUrl:{type:String,value:"http://gostockoz.q7unpsspv9.ap-southeast-2.elasticbeanstalk.com"},company:{type:String,reflectToAttribute:!0},code:{type:String,reflectToAttribute:!0,observer:"attached"},noOfSharesVal:{type:Number,value:0,reflectToAttribute:!0,observer:"valChanged"},calcValue:{type:Number,value:0,reflectToAttribute:!0},brokerage:{type:Number,value:0,reflectToAttribute:!0},details:Object,initiateTransactionPostBody:{type:Object,value:{}},confirmTransactionPostBody:{type:Object,value:{}},initiateTransactionSuccessObject:Object,initiateTransactionErrorObject:Object,confirmTransactionSuccessObject:Object,confirmTransactionErrorObject:Object}}ready(){super.ready()}attached(){console.log(this.code+" was attached"),this.$.detailsRequest.params={stockCode:this.code},this.$.detailsRequest.headers.Authorization="Bearer "+this.storedUser.token,this.$.detailsRequest.generateRequest()}goBack(){window.history.back()}openDialog(){this.$.confirmDialog.open()}_submitOrder(){console.log(this.storedUser.traderId),console.log(1),console.log(this.code),console.log(this.noOfSharesVal),this.initiateTransactionPostBody.TraderID=this.storedUser.traderId,this.initiateTransactionPostBody.TransactionType=1,this.initiateTransactionPostBody.StockCode=this.code,this.initiateTransactionPostBody.TransactionStockQuantity=this.noOfSharesVal,this.$.initiateTransactionRequest.headers.Authorization="Bearer "+this.storedUser.token,this.$.initiateTransactionRequest.generateRequest()}_initiateTransactionSuccess(){console.log("_initiateTransactionSuccess"),console.log(this.initiateTransactionSuccessObject),this.confirmTransactionPostBody.TraderID=this.initiateTransactionSuccessObject.TraderID,this.confirmTransactionPostBody.TransactionID=this.initiateTransactionSuccessObject.TransactionID,this.confirmTransactionPostBody.TransactionType=this.initiateTransactionSuccessObject.TransactionType,this.confirmTransactionPostBody.TransactionTime=this.initiateTransactionSuccessObject.TransactionTime,this.confirmTransactionPostBody.StockCode=this.initiateTransactionSuccessObject.StockCode,this.confirmTransactionPostBody.TransactionStockQuantity=this.initiateTransactionSuccessObject.TransactionStockQuantity,this.confirmTransactionPostBody.TraderStockQuantity=this.initiateTransactionSuccessObject.TraderStockQuantity,this.confirmTransactionPostBody.StockValue=this.initiateTransactionSuccessObject.StockValue,this.confirmTransactionPostBody.TradeValue=this.initiateTransactionSuccessObject.TradeValue,this.confirmTransactionPostBody.BrokerageFee=this.initiateTransactionSuccessObject.BrokerageFee,this.confirmTransactionPostBody.AvailableCash=this.initiateTransactionSuccessObject.AvailableCash,this.confirmTransactionPostBody.CashRemaining=this.initiateTransactionSuccessObject.CashRemaining,this.$.confirmTransactionRequest.headers.Authorization="Bearer "+this.storedUser.token,this.$.confirmTransactionRequest.generateRequest()}_initiateTransactionError(){console.log("_initiateTransactionError"),console.log(this.initiateTransactionErrorObject)}_confirmTransactionSuccess(){console.log("_confirmTransactionSuccess"),console.log(this.confirmTransactionSuccessObject),this.lastTransaction=this.confirmTransactionSuccessObject.LastTransaction}_confirmTransactionError(){console.log("_confirmTransactionError"),console.log(this.confirmTransactionErrorObject)}clearVal(){var a=this.$.noOfShares;a.value="",a.commit()}valChanged(){var a=this.noOfSharesVal;if(0<a?(a>this.details.volume&&(this.noOfSharesVal=this.details.volume,a=this.noOfSharesVal),this.calcValue=a*this.details.close):(this.calcValue=0,this.noOfSharesVal=0),0<this.calcValue){var c=0.1;1e5<=this.calcValue&&(c=0.075),5e5<=this.calcValue&&(c=0.05);var d=50+c*this.calcValue;this.brokerage=d}}}window.customElements.define(GoStockCompanyBuy.is,GoStockCompanyBuy);</script></dom-module></body></html>