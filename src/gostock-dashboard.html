<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/app-route/app-route.html"><link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html"><link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../bower_components/iron-selector/iron-selector.html"><link rel="import" href="../bower_components/iron-collapse/iron-collapse.html"><link rel="import" href="../bower_components/iron-localstorage/iron-localstorage.html"><link rel="import" href="../bower_components/brum-global-variable/brum-global-variable.html"><link rel="import" href="elements/gostock-dashboard-summary.html"><link rel="import" href="elements/gostock-dashboard-leaderboard.html"><link rel="import" href="elements/gostock-dashboard-details.html"><link rel="import" href="shared-styles.html"></head><body><dom-module id="gostock-dashboard"><template><style include="shared-styles">:host{display:block;padding:10px;}.content{display:grid;grid-template-columns:60% 40%;}.green-bg{background-color:#34BB77;border-radius:12px;}.row-layout{display:grid;grid-template-rows:1fr 400px 1fr;height:calc(100vh - 30px);width:calc(100% - 45px);margin-top:15px;margin-left:15px;min-height:400px;}.column-layout{display:grid;grid-template-columns:1fr 400px 1fr;}.row{border-radius:5px;}.column{border-radius:5px;display:flex;flex-direction:column;justify-content:center;align-items:center;}.rounded-button-blue{color:white;width:100px;height:36px;border:none;border-radius:8px;background-color:rgb(17, 158, 223);}.rounded-green-input{text-align:center;color:white;border-radius:8px;border:1.4px solid #2C373D;width:240px;height:36px;background-color:transparent;margin:5px;}::placeholder{color:#2C373D;opacity:1;}:-ms-input-placeholder{color:#2C373D;}::-ms-input-placeholder{color:#2C373D;}#createAccountDiv h1{color:#2C373D;font-size:30px;line-height:30px;font-weight:300;}#createAccountDiv h1 span{font-weight:600;}#myShares{background-color:#2C373D;}#myShares p{color:#E7E7E7;font-weight:600;}h1{color:white;line-height:23px;}h1 span{font-weight:300;}#sumContainer{display:grid;grid-template-columns:1fr 0.1fr;grid-auto-rows:30px;}#sumContainer p{color:#E7E7E7;font-weight:200;}#sumContainer p span{color:white;font-weight:600;}#line1{height:1px;width:60%;position:relative;background-color:white;margin-top:60px;}#viewSharesBtn{background-color:#34BB77;border:none;color:white;padding:12px;text-align:center;text-decoration:none;display:inline-block;font-family:'Open Sans', sans, sans-serif;font-size:16px;border-radius:12px;text-transform:uppercase;margin-left:calc(100% - 180px);margin-top:30px;width:180px;outline:none;cursor:pointer;}#moreShares{margin-top:60px;width:100%;}#leaderBoard{background-color:#34BB77;max-height:550px;}.lbDivs{width:var(100%-20px);padding:10px;margin-top:-20px;display:block;}.lbContent{display:grid;grid-template-columns:10% 70% 20%;height:30px;}.lbContent p{color:#E7E7E7;font-weight:200;}.lbContent p span{color:white;font-weight:600;}.right{text-align:right;}#line{height:1px;width:80% margin 0 auto;position:relative;background-color:white;margin-top:40px;margin-bottom:20px;}.id{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}#top{display:var(--hide-top);}#bot{display:var(--hide-bot);}.form-inline{width:100%;display:flex;justify-content:space-between;align-items:center;}.form-left{width:100%;display:flex;justify-content:flex-start;}.form-right{width:100%;display:flex;justify-content:flex-end;}</style><brum-global-variable key="userData" value="{{storedUser}}"></brum-global-variable><iron-localstorage name="user-storage" value="{{storedUser}}"></iron-localstorage><app-location use-hash-as-path="" route="{{route}}"></app-location><app-route route="{{route}}" pattern="/details/:id" data="{{routeData}}" tail="{{detRoute}}" active="{{active}}"></app-route><div class="green-bg" hidden$="{{storedUser.hasTradingAccount}}"><iron-ajax id="createAccountQuery" method="GET" handle-as="json" content-type="application/json" on-response="_createAccountSuccess" last-response="{{createAccountSuccessObject}}" on-error="_createAccountError" last-error="{{createAccountErrorObject}}" verbose="true" url="{{apiUrl}}/tradingaccountregistration/registertrader/{{storedUser.userId}}/{{nicknameValue}}"></iron-ajax><div class="row-layout"><b class="row"></b><div class="column-layout"><b class="column"></b><form class="column" name="loginForm" id="loginForm"><div id="createAccountDiv" class="form-left"><h1>CREATE<br><span>TRADING ACCOUNT</span></h1></div><br><br><div class="form-inline">Nickname*: <input class="rounded-green-input" type="text" name="nickname" id="nicknameInput" placeholder="Nickname" value="{{nicknameValue::input}}"></div><br><div class="form-right"><button class="rounded-button-blue" type="button" id="createTradingAccountBtn" on-click="_createTradingAccount">CREATE</button></div></form><b class="column"></b></div><b class="row"></b></div></div><div hidden$="{{!storedUser.hasTradingAccount}}"><div class="content"><iron-ajax auto="" url="{{apiUrl}}/leaderboard/getleaderboard" handle-as="json" last-response="{{lb}}" on-response="postComplete"></iron-ajax><div class="card" id="myShares" hidden$="{{active}}"><div><iron-ajax auto="" url="{{apiUrl}}/holdings/getholdings/{{storedUser.traderId}}" handle-as="json" last-response="{{holdings}}" on-response="postHoldings"></iron-ajax><h1><span>ACCOUNT</span><br>SUMMARY</h1><div id="sumContainer"><p>NAME</p><p class="right">[[storedUser.traderName]]</p><p>CASH</p><p class="right">$[[storedUser.currentCash]]</p><p>SHARES</p><p class="right">$[[storedUser.currentStockValue]]</p><p>PORTFOLIO VALUE</p><p class="right">$[[storedUser.totalValue]]</p><p>DAILY CHANGE %</p><p class="right">[[storedUser.dailyChange]]%</p><p><span>OVERALL RANK</span></p><p class="right"><span>[[storedUser.overallRank]]</span></p></div><div id="line1"></div><p>MY TOP SHARES</p><div id="topShares"><template is="dom-repeat" id="stocks" items="{{newHoldings}}"><gostock-dashboard-summary class="summary" code="{{item.StockCode}}"></gostock-dashboard-summary></template></div><button id="viewSharesBtn" on-click="toggle">{{btnTitle}}</button><iron-collapse id="collapse"><div id="moreShares"><div id="line1"></div><p>All SHARES</p><template is="dom-repeat" id="stocks" items="{{holdings}}"><gostock-dashboard-summary class="summary" code="{{item.StockCode}}"></gostock-dashboard-summary></template></div></iron-collapse></div></div><div class="card" id="leaderBoard" hidden$="{{active}}"><div><h1><span>LEADER</span><br>BOARD</h1><template is="dom-repeat" id="leaders" items="{{lb}}"><gostock-dashboard-leaderboard rank="[[index]]" id="{{item.TraderName}}" total="{{item.TotalValue}}"></gostock-dashboard-leaderboard></template><div id="line"></div><div class="lbDivs"><div id="top"><div class="lbContent"><p>{{rank1}}</p><div><p class="id">{{name1}}</p></div><p>{{total1}}</p></div></div><div class="lbContent"><p><span>{{rank2}}</span></p><div><p><span class="id">{{name2}}</span></p></div><p><span>{{total2}}</span></p></div><div id="bot"><div class="lbContent"><p>{{rank3}}</p><div><p class="id">{{name3}}</p></div><p>{{total3}}</p></div></div></div></div></div></div><div class="card" hidden$="{{!active}}"><gostock-dashboard-details code="{{routeData.id}}" route="{{detRoute}}"></gostock-dashboard-details></div></div></template><script>class GoStockDashboard extends Polymer.Element{constructor(){super()}static get is(){return'gostock-dashboard'}static get properties(){return{apiUrl:{type:String,value:'http://gostockoz.q7unpsspv9.ap-southeast-2.elasticbeanstalk.com'},route:Object,routeData:Object,storedUser:Object,lastTransaction:String,nicknameValue:{type:String,observer:'_nicknameValueChanged'},traderID:{type:String,reflectToAttribute:!0,value:'testytesty'},newHoldings:{type:Object,reflectToAttribute:!0},btnTitle:{type:String,value:'VIEW MORE',reflectToAttribute:!0},id:{type:String,reflectToAttribute:!0,observer:'_idChanged'},rank1:{type:String,reflectToAttribute:!0},rank2:{type:String,reflectToAttribute:!0},rank3:{type:String,reflectToAttribute:!0},name1:{type:String,reflectToAttribute:!0},name2:{type:String,reflectToAttribute:!0},name3:{type:String,reflectToAttribute:!0},total1:{type:String,reflectToAttribute:!0},total2:{type:String,reflectToAttribute:!0},total3:{type:String,reflectToAttribute:!0},cash:{type:String,reflectToAttribute:!0},shares:{type:String,reflectToAttribute:!0},tog:{type:Boolean,value:!1}}}ready(){super.ready(),this.set('route.path',''),console.log('has trading account: '+this.storedUser.hasTradingAccount)}postHoldings(a){for(var b=a.detail.response.sort(this.compare),c=[],d=0;d<b.length;d++)3>d&&c.push(b[d]);this.newHoldings=c}compare(c,a){return c.Quantity>a.Quantity?-1:c.Quantity<a.Quantity?1:0}_createTradingAccount(){console.log('Create trading account'),this.$.createAccountQuery.headers.Authorization='Bearer '+this.storedUser.token,this.$.createAccountQuery.generateRequest()}_createAccountSuccess(){if(this.createAccountSuccessObject.hasOwnProperty('Message'))return alert(this.createAccountSuccessObject.Message),!1;var a=Object.assign({},this.storedUser);a.hasTradingAccount=!0,a.traderName=this.createAccountSuccessObject.Tradername,a.currentCash=this.createAccountSuccessObject.CashAmount,a.currentStockValue=this.createAccountSuccessObject.HoldingsValue,a.totalValue=this.createAccountSuccessObject.TotalValue,a.dailyChange=0,this.set('storedUser',a)}_createAccountError(){}postComplete(a){for(var b,c=0;c<a.detail.response.length;c++)if(b=a.detail.response[c],b.TraderID==this.storedUser.traderId){if(0<c){var d=a.detail.response[c-1];this.rank1=c,this.name1=d.TraderName,this.total1=d.TotalValue,this.updateStyles({"--hide-top":'block'})}else this.updateStyles({"--hide-top":'none'});if(this.rank2=c+1,this.name2=b.TraderName,this.total2=b.TotalValue,this.cash=b.CurrentCash,this.shares=b.CurrentStockValue,c+1<a.detail.response.length){var e=a.detail.response[c+1];this.rank3=c+2,this.name3=e.TraderName,this.total3=e.TotalValue,this.updateStyles({"--hide-bot":'block'})}else this.updateStyles({"--hide-bot":'none'});break}}toggle(){this.$.collapse.toggle(),this.tog?(this.btnTitle='VIEW MORE',this.tog=!1):(this.btnTitle='VIEW LESS',this.tog=!0)}static get observers(){return['_routeIdChanged(routeData.id)']}_routeIdChanged(){}_idChanged(){}_nicknameValueChanged(){console.log('nickname: '+this.nicknameValue)}}window.customElements.define(GoStockDashboard.is,GoStockDashboard);</script></dom-module></body></html>