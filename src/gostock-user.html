<html><head><link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/iron-localstorage/iron-localstorage.html"><link rel="import" href="../bower_components/brum-global-variable/brum-global-variable.html"><link rel="import" href="shared-styles.html"></head><body><dom-module id="gostock-user"><template><style include="shared-styles">:host{background-color:#2C373D;}body{background-color:#2C373D;}.dark-green-bg{background-color:#2C373D;}.rounded-green-input{text-align:center;color:white;border-radius:8px;border:1.4px solid #34BB77;width:240px;height:36px;background-color:transparent;margin:5px;}::placeholder{color:white;opacity:1;}:-ms-input-placeholder{color:white;}::-ms-input-placeholder{color:white;}.rounded-button{color:white;width:160px;height:36px;border:none;border-radius:8px;background-color:#34BB77;}.row-layout{display:grid;grid-template-rows:1fr 300px 1fr;height:calc(100vh - 30px);width:calc(100vw - 45px);margin-top:15px;margin-left:15px;min-height:400px;}.column-layout{display:grid;grid-template-columns:1fr 300px 1fr;}.row{border-radius:5px;}.column{border-radius:5px;display:flex;flex-direction:column;justify-content:center;align-items:center;}img{height:36px;}a{color:gray;text-decoration:none;font-size:10pt;}a.forgot{color:gray;text-decoration:none;font-size:10pt;font-style:italic;}</style><brum-global-variable key="userData" value="{{storedUser}}"></brum-global-variable><iron-localstorage name="user-storage" value="{{storedUser}}"></iron-localstorage><app-route route="[[route]]" pattern="/login" active="{{loginActive}}"></app-route><app-route route="[[route]]" pattern="/register" active="{{registerActive}}"></app-route><app-route route="[[route]]" pattern="/forgot-password" active="{{forgotPasswordActive}}"></app-route><div class="dark-green-bg" hidden$="{{!loginActive}}"><iron-ajax id="authoriseRequest" method="POST" body="[[authorisePostBody]]" handle-as="json" content-type="application/json" on-response="handleAuthoriseSuccess" last-response="{{authoriseSuccessObject}}" on-error="handleAuthoriseError" last-error="{{authoriseErrorObject}}" verbose="true" url="http://gostockoz.q7unpsspv9.ap-southeast-2.elasticbeanstalk.com/users/authoriseuser"></iron-ajax><div class="row-layout"><b class="row"></b><div class="column-layout"><b class="column"></b><form class="column" name="loginForm" id="loginForm"><img src="../images/logo-inverse.png" alt="" srcset=""><br><br><input class="rounded-green-input" type="email" name="email" id="emailInput" placeholder="Email"> <input class="rounded-green-input" type="password" name="password" id="passwordInput" placeholder="Password"><br><button class="rounded-button" type="button" id="loginButton" on-click="handleLogin">LOGIN</button><br><a href="user/register">or REGISTER</a><br><a class="forgot" href="user/forgot-password">Forgot password?</a></form><b class="column"></b></div><b class="row"></b></div></div><div class="dark-green-bg" hidden$="{{!registerActive}}"><iron-ajax id="registerRequest" method="POST" body="{{registerPostBody}}" handle-as="json" content-type="application/json" on-response="handleRegisterSuccess" last-response="{{registerSuccessObject}}" on-error="handleRegisterError" last-error="{{registerErrorObject}}" url="http://gostockoz.q7unpsspv9.ap-southeast-2.elasticbeanstalk.com/users/adduser"></iron-ajax><div class="row-layout"><b class="row"></b><div class="column-layout"><b class="column"></b><form class="column" name="registerForm" id="registerForm"><img src="../images/logo-inverse.png" alt="" srcset=""><br><br><input class="rounded-green-input" type="email" name="email" id="registerEmailInput" placeholder="Email"> <input class="rounded-green-input" type="password" name="password" id="registerPasswordInput" placeholder="Password"> <input class="rounded-green-input" type="password" name="confirmPassword" id="registerConfirmPasswordInput" placeholder="Confirm Password"><br><button class="rounded-button" type="button" id="registerButton" on-click="handleRegister">REGISTER</button><br><a href="user/login">or LOGIN</a></form><b class="column"></b></div><b class="row"></b></div></div><div class="dark-green-bg" hidden$="{{!forgotPasswordActive}}"><div class="row-layout"><b class="row"></b><div class="column-layout"><b class="column"></b><form class="column" name="forgotPasswordForm" id="forgotPasswordForm"><img src="../images/logo-inverse.png" alt="" srcset=""><br><br><input class="rounded-green-input" type="email" name="email" id="resetEmailInput" placeholder="Email"><br><button class="rounded-button" type="button" id="resetButton" on-click="handleReset">RESET PASSWORD</button><br><a href="user/login">or LOGIN</a></form><b class="column"></b></div><b class="row"></b></div></div></template><script>class GoStockUser extends Polymer.Element{static get is(){return"gostock-user"}static get properties(){return{route:Object,routeData:Object,storedUser:{type:Object,reflectToAttribute:!0},registerPostBody:Object,registerSuccessObject:Object,registerErrorObject:Object,authorisePostBody:Object,authoriseSuccessObject:Object,authoriseErrorObject:Object}}handleLogin(){return this.$.emailInput.value?this.$.passwordInput.value?(this.authorisePostBody={userPrimaryEmail:this.$.emailInput.value,userPassword:this.$.passwordInput.value,expireMinutes:1},this.$.authoriseRequest.generateRequest(),!1):(alert("Please enter your password."),!1):(alert("Please enter your email address."),!1)}handleAuthoriseSuccess(){return(console.log(this.authoriseSuccessObject),this.authoriseSuccessObject.error)?("User not confirmed"==this.authoriseSuccessObject.error?alert("Check your email to confirm your email address, then try again."):"User not authorised"==this.authoriseSuccessObject.error?alert("Wrong password"):alert("Error: "+this.authoriseSuccessObject.error),!1):(console.log("Authorisation success"),console.log("userId: "+this.authoriseSuccessObject.userId),console.log("token: "+this.authoriseSuccessObject.token),this.storedUser={userId:this.authoriseSuccessObject.userId,token:this.authoriseSuccessObject.token,loggedIn:!0,hasTradingAccount:!1},!1)}handleAuthoriseError(){if(console.log(this.authoriseErrorObject),500===this.authoriseErrorObject.status){var a=this.authoriseErrorObject.response.Message;"An error has occurred."===a?alert("Unknown email address"):alert(a)}else alert("API responded with an error");return!1}handleRegister(){return this.$.registerEmailInput.value?this.$.registerPasswordInput.value?this.$.registerPasswordInput.value===this.$.registerConfirmPasswordInput.value?(this.registerPostBody={UserPrimaryEmail:this.$.registerEmailInput.value,UserPassword:this.$.registerConfirmPasswordInput.value},this.$.registerRequest.generateRequest(),!1):(alert("Passwords do not match."),!1):(alert("Please enter your password."),!1):(alert("Please enter your email address."),!1)}handleRegisterSuccess(){return alert("Registration successful, please check your email to activate your account."),this.set("route.path","/login"),!1}handleRegisterError(){return alert("A user account with this email address already exists."),!1}handleReset(){return alert("If this actually worked, you would get an email to reset your password."),!1}}window.customElements.define(GoStockUser.is,GoStockUser);</script></dom-module></body></html>